// src/middleware/etag/index.ts
import { sha1 } from "../../utils/crypto.js";
var etag = (options = { weak: false }) => {
  return async (c, next) => {
    const ifNoneMatch = c.req.header("If-None-Match") || c.req.header("if-none-match");
    await next();
    const res = c.res;
    const clone = res.clone();
    const hash = await sha1(res.body || "");
    const etag2 = options.weak ? `W/"${hash}"` : `"${hash}"`;
    if (ifNoneMatch && ifNoneMatch === etag2) {
      await clone.blob();
      c.res = new Response(null, {
        status: 304,
        statusText: "Not Modified",
        headers: {
          ETag: etag2
        }
      });
      c.res.headers.delete("Content-Length");
    } else {
      c.res = new Response(clone.body, clone);
      c.res.headers.append("ETag", etag2);
    }
  };
};
export {
  etag
};
